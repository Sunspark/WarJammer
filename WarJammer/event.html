<html>
	<head>
		<title>event generator test</title>
        <script type="text/javascript" src="js/hit_table.js"></script>
        <script type="text/javascript" src="js/monster_db.js"></script>
        <script type="text/javascript" src="js/monster.js"></script>
        <script type="text/javascript" src="js/dice_roller.js"></script>
        <script type="text/javascript" src="js/event_db.js"></script>
        <script type="text/javascript" src="js/event_generator.js"></script>
	</head>
	<body>
		<div id="interface">
            <select id="dungeon_level">
                <option value="1" selected="selected">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
			<input id="objective_checkbox" type="checkbox" />Objective room<br />
			<button id="roll" onClick="newEventDraw();">Roll Me</button>
		</div>
		<hr />
        <div id="results"></div>
        <script language="javascript">
        <!--
        

        // need to add handling for not present warriors
        
        -->
        </script>
		<script language="javascript">
		<!--
			var _event = {};

/**
 * generates a new event, and calls populate
 *
 */
function newEventDraw() {
	'use strict';
	// check for presence of _event
	var _event_generator = new EventGenerator();
	_event = _event_generator.generateEvent(dungeon_level.value, objective_checkbox.checked);
	console.log(_event);
    populateEventTable();
}
/**
 * populates the event page with values from the global _event on the page
 *
 */
function populateEventTable() {
    'use strict';
    // check for presence of _event
    var strEventTable = '';
    
    strEventTable = strEventTable + '<table>';
    strEventTable = strEventTable + '<tr><td>' + _event.eventType + '</td></tr>';
    strEventTable = strEventTable + '<tr><td>' + _event.eventDescription + '</td></tr>';
    if (_event.eventType === 'MONSTERS') {
        strEventTable = strEventTable + '<tr><td>' + generateMonsterTable() + '</td></tr>';
    }
    strEventTable = strEventTable + '</table>';
    results.innerHTML = strEventTable;
}
/**
 * creates a table with tables for each monster from the global _event on the page
 *
 */
function generateMonsterTable() {
    'use strict';
    // check for presence of _event
    var
        strMonsterTable = '',
        i = 0
    ;

    strMonsterTable = strMonsterTable + '<table>';
    for (i = 0; i < _event.monsters.length; i = i + 1) {
        strMonsterTable = strMonsterTable + '<tr><td>' + generateMonsterEntryTable(i) + '</td></tr>';
    }
    strMonsterTable = strMonsterTable + '</table>';
    
    return strMonsterTable;
}
/**
 * creates a table with tables for each monster from the global _event on the page
 *
 * @param {integer} intMonsterId - the array index that the monster is in in the global event
 */
function generateMonsterEntryTable(intMonsterId) {
    'use strict';
    // check for presence of _event
    var
        strMonsterTable = '',
        objThisMonster = _event.monsters[intMonsterId]
    ;

    strMonsterTable = strMonsterTable + '<table>';
    
    // stat titles row
    strMonsterTable = strMonsterTable + '<tr>';
    strMonsterTable = strMonsterTable + '<th>' + objThisMonster.nameSingular + '</th>';
    strMonsterTable = strMonsterTable + '<td>Mov</td>';
    strMonsterTable = strMonsterTable + '<td>WS</td>';
    strMonsterTable = strMonsterTable + '<td>BS</td>';
    strMonsterTable = strMonsterTable + '<td>Str</td>';
    strMonsterTable = strMonsterTable + '<td>Tuf</td>';
    strMonsterTable = strMonsterTable + '<td>Int</td>';
    strMonsterTable = strMonsterTable + '<td>Att</td>';
    strMonsterTable = strMonsterTable + '<td>Armour</td>';
    strMonsterTable = strMonsterTable + '<td>Damage</td>';
    strMonsterTable = strMonsterTable + '<td>Gold</td>';
    strMonsterTable = strMonsterTable + '<td>Special</td>';
    strMonsterTable = strMonsterTable + '</tr>';

    // mob values row
    strMonsterTable = strMonsterTable + '<tr>';
    strMonsterTable = strMonsterTable + '<td><span id="monsterHits' + intMonsterId + '">' + objThisMonster.currentHits + '</span>/' + objThisMonster.startingHits + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.moveRate + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.weaponSkill + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.ballisticSkill + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.strength + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.toughness + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.initiative + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.attacks + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.armour + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.damage + 'd6</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.goldValue + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + objThisMonster.specialRules + '</td>';
    strMonsterTable = strMonsterTable + '</tr>';

    // Defender's ws row
    strMonsterTable = strMonsterTable + '<tr>';
    strMonsterTable = strMonsterTable + "<th>Defender's WS</th>";
    strMonsterTable = strMonsterTable + '<td>1</td>';
    strMonsterTable = strMonsterTable + '<td>2</td>';
    strMonsterTable = strMonsterTable + '<td>3</td>';
    strMonsterTable = strMonsterTable + '<td>4</td>';
    strMonsterTable = strMonsterTable + '<td>5</td>';
    strMonsterTable = strMonsterTable + '<td>6</td>';
    strMonsterTable = strMonsterTable + '<td>7</td>';
    strMonsterTable = strMonsterTable + '<td>8</td>';
    strMonsterTable = strMonsterTable + '<td>9</td>';
    strMonsterTable = strMonsterTable + '<td>10</td>';
    strMonsterTable = strMonsterTable + '<td>&nbsp;</td>';
    strMonsterTable = strMonsterTable + '</tr>';
    
    // to hit score row
    //intTargetNumber = gobjToHitTable[intAttackersWs][intDefendersWs];
    strMonsterTable = strMonsterTable + '<tr>';
    strMonsterTable = strMonsterTable + '<th>To Hit</th>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][1] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][2] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][3] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][4] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][5] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][6] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][7] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][8] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][9] + '</td>';
    strMonsterTable = strMonsterTable + '<td>' + gobjToHitTable[objThisMonster.weaponSkill][10] + '</td>';
    strMonsterTable = strMonsterTable + '<td><span id="hurtBlock' + intMonsterId +'"><input id="hurtBox' + intMonsterId +'" type="text" maxlength="2" size="2" /><button id="hurtButton-' + intMonsterId + '" onClick="hurtMonster(this.id);">Hurt Me</button></span></td>';
    strMonsterTable = strMonsterTable + '</tr>';
    
    strMonsterTable = strMonsterTable + '</table>';
    
    return strMonsterTable;
}
 
function hurtMonster(strButtonId) {
    console.log(strButtonId);
    var
	    strMonsterId = '',
	    intMonsterId = 0,
        strHurtBoxId = '',
        strHurtBoxContents = '',
        intHurtPoints = 0,
        strMonsterHitDisplayId = '',
        strHurtBlockId = ''
        ;
    strMonsterId = String(strButtonId).split(/\-/)[1];
    strHurtBoxId = 'hurtBox' + strMonsterId;
    strHurtBoxContents = document.getElementById(strHurtBoxId).value;
    
    if (strHurtBoxContents.match(/^\d{1,2}$/) !== null) {
        // hurting the monster.
        // alert('ow!');
        intMonsterId = parseInt(strMonsterId, 10);
        intHurtPoints = parseInt(strHurtBoxContents, 10);
        _event.monsters[intMonsterId].takeDamage(intHurtPoints);
        strMonsterHitDisplayId = 'monsterHits' + intMonsterId;
        document.getElementById(strMonsterHitDisplayId).innerHTML = _event.monsters[intMonsterId].currentHits;

        if (_event.monsters[intMonsterId].currentHits === 0) {
            strHurtBlockId = 'hurtBlock' + intMonsterId;
            document.getElementById(strHurtBlockId).style.display = 'none';
        }
    } else {
        // who's the real monster?
        alert('The amount of HP to deal to the monster must be one or two digits');
    }
           
    
    
}
 
		-->
		</script>
	</body>
</html>